FROM mcr.microsoft.com/playwright:v1.57.0-noble

ENV PNPM_HOME="/pnpm"
ENV PATH="$PNPM_HOME:$PATH"
ENV COREPACK_ENABLE_DOWNLOAD_PROMPT=0
RUN corepack enable pnpm

WORKDIR /app
COPY package.json pnpm-lock.yaml pnpm-workspace.yaml ./
COPY ./packages/ ./packages/
COPY ./apps/imdbgraph/package.json package.json
RUN  --mount=type=cache,id=pnpm,target=/pnpm/store pnpm i
WORKDIR /app/apps/imdbgraph
COPY ./apps/imdbgraph/ .
ENTRYPOINT ["pnpm", "playwright", "test"]
